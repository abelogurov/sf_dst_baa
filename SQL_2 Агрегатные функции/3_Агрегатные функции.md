### 3. Агрегатные функции
Добавить страницу в мои закладки
Кроме простых математических операций, которые мы использовали в предыдущем модуле, СУБД позволяет проводить статистические вычисления для нескольких строк.

### ПОПРОБУЙТЕ В METABASE!

Давайте посчитаем количество строк в таблице. Для этого применим агрегатную функцию COUNT.

1. SELECT
2.     COUNT(*)
3. FROM sql.pokemon

COUNT считает строки, а звёздочка (*) в аргументе функции означает, что считаются все строки, которые возвращает запрос.

Если в аргументе функции указать название столбца, функция обработает только строки с непустым значением.

### Задание 3.1

Сколько покемонов имеет дополнительный тип?

1. SELECT
2.     COUNT(type2)
3. FROM sql.pokemon

Внутри функции COUNT мы можем также применять DISTINCT, чтобы вычислить количество уникальных значений.

### ПОПРОБУЙТЕ В METABASE!

1. SELECT /*выбор*/
2.     COUNT(DISTINCT type1) /*функция подсчёта строк; уникальные значения столбца type1*/
3. FROM sql.pokemon /*из таблицы sql.pokemon*/

### Задание 3.2

Совпадает ли количество различных основных и дополнительных типов?

SELECT
    COUNT(DISTINCT type1)
FROM sql.pokemon
### 18

SELECT
    COUNT(DISTINCT type2)
FROM sql.pokemon
### 18

### Назовём основные агрегатные функции, с которыми нам предстоит работать:

- COUNT — вычисляет число непустых строк;
- SUM — вычисляет сумму;
- AVG — вычисляет среднее;
- MAX — вычисляет максимум;
- MIN — вычисляет минимум.

### Задание 3.3

Найдите максимальное значение атаки среди всех покемонов.

SELECT
    MAX(attack)
FROM sql.pokemon

### Задание 3.4

Какое среднее количество очков здоровья у покемонов-драконов (то есть тех, у кого основной тип — Dragon)?

SELECT
    AVG(hp)
FROM sql.pokemon
WHERE type1 = 'Dragon'
### 83.31

Кроме того, мы можем применять несколько агрегатных функций в одном запросе.

### ПОПРОБУЙТЕ В METABASE!

1. SELECT /*выбор*/
2.     COUNT(*) AS "всего травяных покемонов", /*подсчёт всех строк; назначить алиас "всего травяных покемонов"*/
3.     COUNT(type2) AS "покемонов с дополнительным типом", /*подсчёт непустых строк в столбце type2; назначить алиас "покемонов с дополнительным типом"*/
4.     AVG(attack) AS "средняя атака", /*среднее значение столбца attack; назначить алиас "средняя атака"*/
5.     AVG(defense) AS "средняя защита" /*среднее значение столбца defense; назначить алиас "средняя защита"*/
6. FROM sql.pokemon /*из таблицы sql.pokemon*/
7. WHERE type1 = 'Grass'/*при условии, что значение столбца type1 содержит grass*/

### Задание 3.5

Напишите запрос, который выведет:

- количество покемонов (столбец pokemon_count);
- среднюю скорость (столбец avg_speed);
- максимальное и минимальное число очков здоровья (столбцы max_hp и min_hp)
- для электрических (Electric) покемонов, имеющих дополнительный тип и показатели атаки или защиты больше 50.

1. SELECT
2.     COUNT(*) AS "pokemon_count",
3.     AVG(speed) AS "avg_speed",
4.     MAX(hp) AS "max_hp",
5.     MIN(hp) AS "min_hp"
6. FROM sql.pokemon
7. WHERE type1 = 'Electric' 
8.     AND type2 is NOT NULL 
9.     AND (attack > 50 OR defense > 50)