### 3. Знакомимся с JOIN

В прошлом юните для соединения таблиц мы использовали условие в разделе where, чтобы показать принцип работы оператора JOIN.

JOIN — это оператор SQL, который позволяет соединять таблицы по условию.

ЗапросДетализация
1. SELECT 
2.     long_name,  /*столбец long_name таблицы teams*/
3.     home_team_goals, /*столбец home_team_goals таблицы matches*/
4.     away_team_goals /*столбец away_team_goals таблицы matches*/
5. FROM
6.     sql.teams, /*таблица с командами*/
7.     sql.matches /*таблица с матчами*/
8. WHERE home_team_api_id = api_id /*условие: home_team_api_id таблицы matches равен api_id таблицы teams*/

и запишем его с использованием JOIN.

### ПОПРОБУЙТЕ В METABASE!

1. SELECT 
2.     long_name, /*столбец long_name таблицы teams*/
3.     home_team_goals, /*столбец home_team_goals таблицы matches*/
4.     away_team_goals /*столбец away_team_goals таблицы matches*/
5. FROM    
6.     sql.teams /*таблица с командами*/
7. JOIN sql.matches on home_team_api_id = api_id /*оператор соединения таблиц; таблица matches; условие: home_team_api_id 

таблицы matches равен api_id таблицы teams*/

### Задание 3.1

Перепишите запрос из прошлого юнита

SELECT *
FROM
    sql.teams,
    sql.matches
WHERE away_team_api_id = api_id
с использованием JOIN.

### Ответ

1. SELECT *
2. FROM
3.     sql.teams
4. JOIN sql.matches on away_team_api_id = api_id

### СИНТАКСИС

Оператор JOIN упрощает процесс соединения таблиц.

Его синтаксис можно представить следующим образом:

1. SELECT
2.         столбец1,
3. 	столбец2,
	...
4. FROM
5. 	таблица1
6. JOIN таблица2 ON условие

Порядок присоединения таблиц в данном случае не важен — результат будет одинаковым.

С помощью JOIN можно соединить и более двух таблиц.

1. SELECT
2.         столбец1,
3. 	столбец2,
	...
4. FROM
5. 	таблица1
6. JOIN таблица2 ON условие
7. JOIN таблица3 ON условие

В таблицах, которые мы соединяем, могут быть одинаковые названия столбцов.

К примеру, столбец id есть и в таблице matches, и в таблице teams. Такой запрос не будет обработан.

### ПОПРОБУЙТЕ В METABASE!

1. SELECT
2.     id /*столбец id, но не указано какой таблицы*/
3. FROM 
4. sql.teams /*таблица teams*/
5.     JOIN sql.matches ON home_team_api_id = api_id /*оператор соединения таблиц; таблица matches; условие: home_team_api_id таблицы matches равен api_id таблицы teams*/

В результате должно появиться сообщение об ошибке вроде такого: "... column id is ambiguous ...".

Что же делать в таком случае?

Можно указать, откуда мы хотим запросить данные, записав название таблицы перед столбцом через точку.

### ПОПРОБУЙТЕ В METABASE!

1. SELECT
2.     teams.id /*столбец id таблицы teams*/
3. FROM 
4.     sql.teams /*таблица teams*/
5. JOIN sql.matches ON home_team_api_id = api_id /*оператор соединения таблиц; таблица matches; условие: home_team_api_id таблицы matches равен api_id таблицы teams*/

Можно также выбрать и столбец из таблицы matches.

1. SELECT
2.     matches.id /*столбец id таблицы matches*/
3. FROM 
4.     sql.teams /*таблица teams*/
5. JOIN sql.matches ON home_team_api_id = api_id /*оператор соединения таблиц; таблица matches; условие: home_team_api_id таблицы matches равен api_id таблицы teams*/

Зачастую названия таблиц слишком длинные, так что использовать их неудобно.

Упростить обращение к различным таблицам можно, присвоив им сокращённые названия — алиасы (от англ. alias).

### Синтаксис для указания алиаса такой же, как и для названия столбца.

1. SELECT
2.         столбец1,
3. 	столбец2,
	...
4. FROM
5. 	таблица1 AS короткое_название_1
6. JOIN таблица2 AS короткое_название_2 ON условие

Название записывается без пробелов и операторов.

Если необходимо записать название на русском языке ("таблица1") или с пробелом ("table 2"), то алиас можно обернуть в кавычки.

### Важно! Обращаться по такому алиасу придётся также с помощью кавычек.

1. SELECT
2. 	"таблица1".столбец1,
3. 	"table 2".столбец2,
	...
4. FROM
5. 	таблица1 AS "таблица1"
6. 	JOIN таблица2 AS "table 2" ON условие

Использование таких алиасов считается плохой практикой как минимум по двум причинам:

- обращаться с такими алиасами неудобно;
- названия на кириллице можно задать не во всех СУБД.

Вместо алиасов с кавычками рекомендуется давать простое короткое название на латинице, без специальных символов и пробелов. Если таблиц немного и все названия начинаются с разных букв, можно присваивать алиасы по первой букве.

Ключевое слово as, как и в названии столбца, можно опустить в большинстве СУБД.

1. SELECT
2.         столбец1 новое_название_столбца,
3. 	столбец2 новое_название_столбца,
	...
4. FROM
5. 	таблица1 короткое_название_1
6. JOIN таблица2 короткое_название_2 ON условие

Давайте попробуем проделать то же самое для наших таблиц.

### Задание 3.2

Напишите запрос, который выведет два столбца: id матча (match_id) и id домашней команды (team_id), — а затем отсортируйте по id матча в порядке возрастания значений.

1. SELECT
2.     matches.id as match_id,
3.     teams.id as team_id
4. FROM 
5.     sql.matches
6. JOIN sql.teams on home_team_api_id = api_id
7. order by match_id

### ПОПРОБУЙТЕ В METABASE!

Давайте с помощью запроса SQL получим таблицу, содержащую:

- название домашней команды;
- количество забитых домашней командой голов;
- количество забитых гостевой командой голов;
- название гостевой команды.

1. SELECT
2.    h.long_name "домашняя команда", /*столбец long_name таблицы h*/
3.    m.home_team_goals "голы домашней команды", /*столбец home_team_goals таблицы m*/
4.    m.away_team_goals "голы гостевой команды", /*столбец away_team_goals таблицы m*/
5.    a.long_name "гостевая команда" /*столбец long_name таблицы a*/
6. FROM
7.     sql.matches m /*таблица matches с алиасом m*/
8.     JOIN sql.teams h ON m.home_team_api_id = h.api_id /*оператор соединения таблиц; таблица teams с алиасом h; условие: home_team_api_id таблицы m равен api_id таблицы h*/
9.     JOIN sql.teams a ON m.away_team_api_id = a.api_id /*оператор соединения таблиц; таблица teams с алиасом a; условие: away_team_api_id таблицы m равен api_id таблицы a*/

### Задание 3.3

Напишите запрос, который выведет столбцы: id матча, короткое название домашней команды (home_short), короткое название гостевой команды (away_short).
Отсортируйте запрос по возрастанию id матча.

1. SELECT
2.     m.id,
3.     h.short_name home_short,
4.     a.short_name away_short
5. FROM sql.matches m
6. JOIN sql.teams h ON h.api_id = m.home_team_api_id
7. JOIN sql.teams a ON a.api_id = m.away_team_api_id
8. ORDER BY m.id