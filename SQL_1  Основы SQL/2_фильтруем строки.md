### 2. Фильтруем строки

### WHERE

Мы уже знаем, что делать, если нам нужны лишь несколько столбцов из таблицы.

Но как быть, если мы хотим видеть не все строки, а только некоторые из них?

В таком случае нам пригодится ключевое слово WHERE.

### ПОПРОБУЙТЕ В METABASE!

Получим для примера всю информации о фильме, занимающем первую позицию.

1. SELECT * /*выбор всех столбцов*/
2. FROM sql.kinopoisk /*из таблицы sql.kinopoisk*/
3. WHERE position = 1 /*с позицией 1*/

### Задание 2.1

Напишите запрос, чтобы вывести все столбцы для фильмов, которые вышли в прокат в 1999 году.

1. SELECT *
2. FROM sql.kinopoisk
3. WHERE year = 1999

В запросах выше мы использовали знак равно (=), но никто не запретит нам использовать и условные операторы.

Вы можете применять знаки < (меньше), <= (меньше или равно), > (больше), >= (больше или равно).

### ПОПРОБУЙТЕ В METABASE!

Посмотрим на фильмы, которые вышли в прокат до 1984 года.

1. SELECT /*выбор всех полей*/
    position, /*столбец position*/
    movie_title, /*столбец movie_title*/
    year, /*столбец year*/
    director /*столбец director*/
2. FROM sql.kinopoisk /*из таблицы sql.kinopoisk*/
3. WHERE year < 1984 /*при условии, что год создания меньше 1984*/

При этом вы можете комбинировать вывод конкретных столбцов и условия.

Ещё один условный оператор, который нам доступен, — знак неравенства != или <>.

### ПОПРОБУЙТЕ В METABASE!

Выведем все столбцы для всех фильмов, кроме тех, что были сняты в 2000 году.

1. SELECT * /*выбор всех полей*/
2. FROM sql.kinopoisk /*из таблицы sql.kinopoisk*/
3. WHERE year <> 2000 /*если год создания не 2000*/

### AND И OR

Допустим, одного условия нам мало.

В таком случае мы можем комбинировать их с помощью AND и OR.

### ПОПРОБУЙТЕ В METABASE!

Типичная ситуация: выбираем фильм на вечер. Мы хотим, чтобы фильм был относительно современным и с высоким рейтингом.

1. SELECT * /*выбор всех полей*/
2. FROM sql.kinopoisk /*из таблицы sql.kinopoisk*/
3. WHERE year >= 2000 /*при условии, что год создания больше или равен 2000*/
4. AND rating >= 8 /*и с рейтингом от 8 и выше*/

Попробуйте заменить в запросе AND на OR — так вы получите фильмы, которые или вышли в 2000 году и позднее, или имеют высокий рейтинг.

### ПОПРОБУЙТЕ В METABASE!

Теперь вы хотите получить информацию о фильмах, которые вышли между 1975 и 1985 годами включительно. Можно воспользоваться следующим запросом:

1. SELECT * /*выбор всех полей*/
2. FROM sql.kinopoisk /*из таблицы sqk.kinopoisk*/
3. WHERE year >= 1975 /*при условии, что год создания 1975 и позднее*/
4.    AND year <= 1985 /*и ранее 1985*/

### BETWEEN

Мы только что отправили запрос для вывода данных по фильмам с 1975 и 1985 годы. Цели мы достигли, но сама запись оставляет желать лучшего.

### ПОПРОБУЙТЕ В METABASE!

Можем оптимизировать её, сделав более элегантной с помощью BETWEEN:

1. SELECT * /*выбор всех полей*/
2. FROM sql.kinopoisk /*из таблиц sql.kinopoisk*/
3. WHERE year BETWEEN 1975 AND 1985 /*при условии, что год создания лежит в промежутке между 1975 и 1985*/

Если вы знаете английский, назначение BETWEEN не станет для вас неожиданностью: оператор фильтрует строки, которые находятся между двумя значениями.

### Обратите внимание! В PostgreSQL указанные значения включаются в интервал. В других СУБД BETWEEN может работать иначе и не включать указанные значения.

### Задание 2.2

Напишите запрос, который выведет столбцы с именем режиссёра и названием фильмов, у которых рейтинг больше или равен 8.5.

1. SELECT
2.    director,
3.    movie_title
4. FROM sql.kinopoisk
5. WHERE rating >= 8.5

### Задание 2.3

Сколько в представленном списке фильмов, имеющих рейтинг от 8.7 до 8.8 включительно?

1. SELECT
2.     director,
3.     movie_title
4. FROM sql.kinopoisk
5. WHERE rating between 8.7 and 8.8

### NOT

В дополнение к другим операторам можно использовать ключевое слово NOT — оно «переворачивает» следующий за ним оператор.

### ПОПРОБУЙТЕ В METABASE!

Выведем все фильмы, кроме тех, что вышли с 1965 по 1980 годы.

1. SELECT * /*выбор всех полей*/
2. FROM sql.kinopoisk /*из таблицы sql.kinopoisk*/
3. WHERE year NOT BETWEEN 1965 AND 1980 /*при условии, что год создания не лежит в промежутке между 1965 и 1980*/

Если включаете в запрос несколько условий AND и OR, используйте скобки: они работают так же, как и с арифметическими операциями.

Важно! Условия в скобках имеют больший приоритет.

### ПОПРОБУЙТЕ В METABASE!

1. SELECT /*выбор*/
2.    year, /*столбец year*/
3.    movie_title, /*столбец movie_title*/
4.    director /*столбец director*/
5. FROM sql.kinopoisk /*из таблицы sql.kinopoisk*/
5. WHERE (rating > 8.5 AND year < 2000) /*при условии, что рейтинг больше 8.5 и год создания до 2000*/
    OR year >= 2000 /*или год создания — 2000 и позднее*/

### IN

Ещё один полезный оператор для фильтрации строк — IN.

Конструкции с IN имеют следующий вид:

column IN (value1, value2, value3)
Эта запись аналогична следующей: column = value1 OR column = value2 OR column = value3 — но выглядит проще и компактнее.

### Задание 2.4

Напишите запрос, который выводит названия фильмов, вышедших в прокат в 2000, 1985 и 1939 годах.

1. SELECT
2.    movie_title
3. FROM sql.kinopoisk
4. WHERE year in (2000, 1985, 1939)

### ПОПРОБУЙТЕ В METABASE!

Давайте получим информацию о всех фильмах Леонида Гайдая.

1. SELECT * /*выбор всех полей*/
2. FROM sql.kinopoisk /*из таблицы sql.kinopoisk*/
3. WHERE director = 'Леонид Гайдай' /*где режиссёр Леонид Гайдай*/

Попробуйте изменить условие на director = 'ЛЕОНИД ГАЙДАЙ'.

Как видите, ничего не отобразилось, потому что в текстовых полях важен регистр.

### LIKE

Предположим, мы не знаем точно, какое текстовое значение ищем.

В таком случае нам поможет оператор LIKE.

### ПОПРОБУЙТЕ В METABASE!

Например, чтобы получить все фильмы, название которых начинается на А (кириллическую), мы воспользуемся таким запросом:

1. SELECT * /*выбор всех полей*/
2. FROM sql.kinopoisk /*из таблицы sql.kinopoisk*/
3. WHERE movie_title LIKE 'А%' /*если название фильма начинается на А*/

Знак процента (%) в примере показывает, что после A встречается ноль и более символов. Вы можете использовать % в любом месте внутри строки.

Например, movie_title LIKE '%а%б%' выведет все фильмы, в названии которых встречается строчная буква а, а где-то после неё — б.

Также в текстовых строках используется знак подчёркивания (_) — он заменяет ровно один любой символ.

### Задание 2.5

Напишите запрос, чтобы вывести название и год выпуска в прокат тех фильмов, которые были сняты режиссёром по имени Дэвид (то есть значение в поле director начинается с 'Дэвид') и имеют рейтинг больше 8.

1. SELECT
2.     movie_title,
3.     year
4. FROM sql.kinopoisk
5. WHERE director LIKE 'Дэвид%' 
6.     AND rating > 8

### NULL

Вернёмся к просмотру всей таблицы с ТОП-250.

Вы можете заметить, что у некоторых строк заполнены не все столбцы.

Для пустых значений есть специальное обозначение — NULL.

### ПОПРОБУЙТЕ В METABASE!

При этом вы не можете просто приравнять значение к NULL. Проверим это на следующем запросе:

1. SELECT * /*выбор всех полей*/
2. FROM sql.kinopoisk /*из таблицы sql.kinopoisk*/
3. WHERE overview = NULL /*если у фильма отсутствует описание*/

А теперь попробуйте изменить условие на overview IS NULL.

Если вы всё сделали верно, то получили все фильмы, у которых в таблице отсутствует описание.

Вы можете добавить к условию уже изученное ключевое слово NOT, чтобы получилось overview IS NOT NULL, тогда в выводе вы увидите только фильмы с заполненным описанием.

### Важно! NULL — это специальное значение. Если вы фильтруете столбец, в котором есть пустые значения, по любому условию, кроме IS NULL / IS NOT NULL, такие значения будут исключены из вывода.