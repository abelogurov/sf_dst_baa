### 3. Сортировка

### ORDER BY

Когда мы говорили о последовательности столбцов в выводе, вы, вероятно, задались вопросом: «А в каком порядке выводятся строки?

Порядок вывода строк может задаваться в настройках базы данных для каждой таблицы. Более того, этот порядок может быть не задан, и тогда от вывода к выводу он будет разным.

Чтобы задать порядок вывода строк в запросе, применим новое ключевое слово ORDER BY.


### ПОПРОБУЙТЕ В METABASE!

Для примера отсортируем фильмы по их названию в алфавитном порядке.

1. SELECT *
2. FROM sql.kinopoisk
3. ORDER BY movie_title

### Задание 3.1

Напишите запрос, который выведет из таблицы kinopoisk все столбцы, и отсортируйте строки по возрастанию рейтинга фильма.

1. SELECT *
2. FROM sql.kinopoisk
3. ORDER BY rating

Как видите, сортировка по возрастанию проводится по умолчанию.

Наш запрос с сортировкой по названию аналогичен такому:

1. SELECT *
2. FROM sql.kinopoisk
3. ORDER BY rating ASC

### Здесь ASC — явное указание порядка сортировки по возрастанию (англ. ascending).

### Для обратного порядка используется ключевое слово DESC (англ. descending).

1. SELECT *
2. FROM sql.kinopoisk
3. ORDER BY rating DESC

Разумеется, мы можем комбинировать в нашем запросе фильтрацию строк и сортировку вывода, а также выводить только необходимые столбцы.

### ПОПРОБУЙТЕ В METABASE!

Выведем названия, имена режиссёров и сценаристов, а также год выхода в прокат фильмов, выпущенных в СССР, и отсортируем результат по убыванию рейтинга.

1. SELECT /*выбор*/
2.     movie_title, /*столбец movie_title*/
3.     director, /*столбец director*/
4.     screenwriter, /*столбец screenwriter*/
5.     year /*столбец year*/
6. FROM sql.kinopoisk /*из таблицы sql.kinopoisk*/
7. WHERE country = 'СССР' /*при условии, что страна производства — СССР*/
8. ORDER BY rating DESC /*сортировка по рейтингу в порядке убывания*/

### Обратите внимание! Ключевое слово ORDER BY идёт после применения всех условий в WHERE.

### Задание 3.2

Напишите запрос, который выведет столбцы с названием фильма, его описанием и годом выхода в прокат. Оставьте только те фильмы, у которых рейтинг не ниже 8.2 и страна производства — не США.

Отсортируйте вывод по году выхода фильма в порядке убывания.

1. SELECT
2.     movie_title,
3.     overview,
4.     year
5. FROM sql.kinopoisk
6. WHERE rating >= 8.2 
7.     AND country NOT LIKE 'США'
8. ORDER BY year DESC

Также в ORDER BY можно указывать, где должны идти пустые значения — в начале или в конце.

Такая настройка порядка вывода задаётся с помощью ключевых слов NULLS FIRST / NULLS LAST.

### ПОПРОБУЙТЕ В METABASE!

1. SELECT /*выбор*/
2.    director, /*столбец director*/
3.    movie_title /*столбец movie_title*/
4. FROM sql.kinopoisk /*из таблицы sql.kinopoisk*/
5. ORDER BY year, rating DESC /*сортировка по столбцам year и rating в порядке убывания*/

А теперь измените последнюю строку скрипта на ORDER BY overview NULLS FIRST.

Такой запрос выведет первыми строки с пустым описанием.

Вы можете сортировать вывод по нескольким столбцам, просто указав их через запятую в ORDER BY (порядок сортировки указывается отдельно для каждого столбца).

Кроме того, вы можете сортировать результат запроса и по тем столбцам, которых нет в выводе.

### ПОПРОБУЙТЕ В METABASE!

Получили список всех режиссёров и фильмов из ТОП-250, отсортированных по году выхода в прокат, а внутри года — по рейтингу в порядке убывания.

ЗапросДетализация
SELECT
    director,
    movie_title
FROM sql.kinopoisk
ORDER BY year, rating DESC

### Задание 3.3

Напишите запрос, чтобы вывести названия всех фильмов (столбец Название фильма), у которых рейтинг выше 8.3 и страна производства — Франция.

Отсортируйте по рейтингу в порядке убывания, далее — по году выхода в прокат (также в порядке убывания).

1. SELECT
2.    movie_title as "Название фильма"
3. FROM sql.kinopoisk
4. WHERE rating  > 8.3 AND country = 'Франция'
5. ORDER BY rating DESC, year DESC

Для упрощения работы с ORDER BY можно использовать не названия столбцов, а их номера из вывода.

### ПОПРОБУЙТЕ В METABASE!

1. SELECT /*выбор*/
2.    director, /*столбец director*/
3.    movie_title, /*столбец movie_title*/
4.    year /*столбец year*/
5. FROM sql.kinopoisk /*из таблицы sql.kinopoisk*/
6. ORDER BY 1, 3 DESC /*сортировка по первому и третьему столбцам*/

Сортировку по номеру столбца стоит использовать с осторожностью, поскольку при изменении вывода в SELECT всё может сбиться.

При добавлении новых столбцов в SELECT нужно проверить и при необходимости поправить номера столбцов в ORDER BY.