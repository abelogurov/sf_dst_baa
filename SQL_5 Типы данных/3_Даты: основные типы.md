### Даты: основные типы

Любой анализ событий во времени подразумевает работу с датой или временем.

Для них в Postgres существует несколько типов данных — все они представлены в [таблице ниже](https://drive.google.com/file/d/1414ZeAUN2DOjvpyfiK-OgfnDTDeuaE_Y/view?usp=sharing).

### TIMESTAMP

Timestamp — наиболее распространённый тип данных, так как он содержит и дату, и время, а также используется в любых логах событий, временных рядах и в большинстве системных таблиц.

Согласно стандарту ISO, значение выглядит как "2019-07-14 01:35:44.702165+00", где перечислены через точку год-месяц-день, время и часовой пояс.

Для получения текущего значения даты и времени в Postgres используются функции CURRENT_TIMESTAMP (есть в стандарте SQL) и NOW() (есть в большинстве баз данных).

### ПОПРОБУЙТЕ В METABASE!

Выполните запросы:
1. SELECT NOW()
2. SELECT CURRENT_TIMESTAMP

Глядя на вывод, вы заметите, что время отличается на целое число часов от реального времени у вас (если вы не в Лондоне или, скажем, на Канарских островах). В Москве разница составит 3 часа.

Почему так?

Давайте разберёмся.

### TIMESTAMP WITH TIME ZONE

Timestamp with time zone позволяет хранить сведения о часовом поясе, что может быть удобно при анализе географически распределённых временных данных для единообразия хранения.

Предположим, в вашей компании в базу подтягивается время прихода сотрудников на работу. Вы пришли в 10 утра по Москве, а в Екатеринбурге в это время — полдень. Чтобы ваши коллеги из Екатеринбурга поняли, что вы пришли на работу вовремя, им нужно помнить про разницу в часовых поясах. А теперь представим, что пользователи БД разбросаны по всему миру и всем им необходимо помнить о разнице во времени и учитывать её при сверках с другими регионами.

Согласитесь, неудобно. Поэтому временные метки лучше всего хранить в базе в едином часовом поясе.

Посмотрим, как работает этот тип данных.

### ПОПРОБУЙТЕ В METABASE!

Сначала попробуем узнать, в каком часовом поясе выводятся временные данные в настоящий момент. Для этого выполните команду

1. SHOW TIMEZONE

В результате вы увидите GMT — это наиболее частая установка по умолчанию для баз данных. Что он обозначает, можно посмотреть [здесь.](https://ru.wikipedia.org/wiki/Среднее_время_по_Гринвичу)

Список часовых поясов можно увидеть в системном справочнике [pg_timezone_names](https://drive.google.com/file/d/198QNTLWvDGXRU05o_K0jhN1PGB5o9523/view?usp=sharing).

### ПОПРОБУЙТЕ В METABASE!

Посмотрите содержимое этого справочника в Metabase.

А ещё посмотрите ваше время в каком-нибудь часовом поясе, например, в Москве. Для этого выполните в Metabase запрос

1. SELECT NOW() AT TIME ZONE 'Europe/Moscow'

Указание at time zone позволяет переводить дату/время без часового пояса в дату/время с часовым поясом и обратно, а также пересчитывать значения времени для различных часовых поясов.

В таблице ниже приведены примеры того, как работает [at time zone](https://drive.google.com/file/d/1ur2jIjxQM_bwo_WUzT0VL632Fuiy_wBY/view?usp=sharing) для разных типов данных.

### Задание 3.1

Давайте узнаем, сколько сейчас времени в другом регионе, например в Лос-Анджелесе.

Напишите запрос, который выведет текущие время и дату в часовом поясе Лос-Анджелеса ("America/Los_Angeles").
Столбец в выдаче — now (время и дата в нужном часовом поясе).

1. SELECT NOW() AT TIME ZONE 'America/Los_Angeles'

### DATE

С типом date вы уже знакомы, его реализация предельно проста. Отметим только, что тип timestamp (with/without time zone) можно легко перевести в соответствующую дату, используя синтаксис

"timestamp_column"::date
И наоборот, тип date преобразуется в timestamp (дата и 00:00:00) с помощью

"date_column"::timestamp
Для получения текущей даты можно использовать

1. SELECT CURRENT_DATE

или

1. SELECT NOW()::DATE

### Задание 3.2

Предположим, у нас есть дата и время какого-то события и мы хотим посмотреть, к какой дате оно относится для Москвы и для UTC.

Используйте подзапрос

with x as 
(
select '2018-12-31 21:00:00+00'::timestamp with time zone ts
)

и выведите дату в ts в Московском часовом поясе и в поясе UTC.

Столбцы в выдаче: dt_msk (дата в московском часовом поясе), dt_utc (дата в UTC).

1. WITH x AS 
2. (
3. SELECT '2018-12-31 21:00:00+00'::timestamp WITH time zone ts
4. )
5. SELECT 
6.         (ts at time zone 'Europe/Moscow')::date dt_msk,
7.         (ts)::date dt_utc
8. FROM x

### INTERVAL

Interval — тип данных, позволяющий хранить разницу между двумя временными метками. 

Интервалы хранят данные в трёх отдельных полях — месяцах, днях, секундах. Это сделано из-за того, что количество дней в месяце и часов в дне может быть разным. Пример значения такого типа: "195 days -10:52:23.563955".